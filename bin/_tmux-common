#!/usr/bin/env bash
# Shared functions for tmux-agent-workflows scripts.
# Source this file; do not execute directly.

find_pane() {
    local prefix="$1" name="$2"
    local idx
    idx=$(tmux list-windows -t "$prefix" -F '#{window_index}:#{window_name}' 2>/dev/null \
        | awk -F: -v name="$name" '$2 == name {print $1; exit}')
    if [[ -z "$idx" ]]; then
        echo "Error: pane '$name' not found in session '$prefix'" >&2
        return 1
    fi
    echo "$prefix:$idx"
}

validate_name() {
    local label="$1" value="$2"
    if [[ -z "$value" ]]; then
        echo "Error: $label cannot be empty" >&2
        return 1
    fi
    if [[ "$value" =~ [:.!\"\\[:space:]] ]]; then
        echo "Error: $label cannot contain ':', '.', '!', '\"', '\\', or whitespace" >&2
        return 1
    fi
}

session_exists() {
    tmux list-sessions -F '#{session_name}' 2>/dev/null | grep -qx "$1"
}
